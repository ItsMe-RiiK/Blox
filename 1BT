local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Teams = game:GetService("Teams")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local mouse = player:GetMouse()

-- === KONFIGURASI ===
local currentHotkey = Enum.KeyCode.LeftAlt
local savedTransparency = 0 
local SIDEBAR_WIDTH = 0.25 
local CONTENT_WIDTH = 1 - SIDEBAR_WIDTH 

-- === DATABASE TELEPORT ===
local TeleportData = {
	SafeZones = {
		Vector3.new(-428, 42, 9),    -- Red Safezone
		Vector3.new(-428, 42, -190), -- Green Safezone
		Vector3.new(-314, 41, -480), -- Blue Safezone
		Vector3.new(-115, 41, -481)  -- Yellow Safezone
	},
	Flags = {
		{Name = "Hill Flag", Pos = Vector3.new(-27, 101, -79)}
	},
	Spawns = {
		{Name = "Red Spawn", Pos = Vector3.new(-364, 65, -63)},
		{Name = "Green Spawn", Pos = Vector3.new(-364, 65, -263)},
		{Name = "Blue Spawn", Pos = Vector3.new(-241, 65, -417)},
		{Name = "Yellow Spawn", Pos = Vector3.new(-41, 65, -417)},
		{Name = "Orange Spawn", Pos = Vector3.new(159, 65, -417)},
		{Name = "Purple Spawn", Pos = Vector3.new(312, 65, -294)},
		{Name = "White Spawn", Pos = Vector3.new(312, 65, -94)},
		{Name = "Black Spawn", Pos = Vector3.new(313, 65, 106)},
		{Name = "Brown Spawn", Pos = Vector3.new(190, 65, 259)},
		{Name = "Cyan Spawn", Pos = Vector3.new(-10, 65, 259)},
		{Name = "Grey Spawn", Pos = Vector3.new(-210, 65, 259)},
		{Name = "Pink Spawn", Pos = Vector3.new(-364, 65, 137)}
	},
	Teams = {
		{Name = "Red Skyland", Pos = Vector3.new(-418, 494, -47)}
	}
}

-- === SYSTEM VARIABLES ===
local transparencyObjects = {} 
local espEnabled = false
local noclipEnabled = false
local autoEEnabled = false
local walkSpeedEnabled = false
local targetWalkSpeed = 16
local loopBringEnabled = false
local bringTarget = "All" -- "All" atau Nama Player
local bringWhitelist = {} -- Daftar pengecualian

-- 1. SETUP SCREEN GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MasterDashboardGui"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true 
screenGui.Parent = playerGui

-- 2. MAIN FRAME
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0.5, 0, 0.6, 0) 
mainFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.Parent = screenGui
local mainCorner = Instance.new("UICorner"); mainCorner.CornerRadius = UDim.new(0, 12); mainCorner.Parent = mainFrame
table.insert(transparencyObjects, mainFrame)
local draggableMainFrame = Instance.new("UIDragDetector"); draggableMainFrame.Parent = mainFrame

local sizeConstraint = Instance.new("UISizeConstraint")
sizeConstraint.MinSize = Vector2.new(350, 250) 
sizeConstraint.MaxSize = Vector2.new(900, 600)
sizeConstraint.Parent = mainFrame

-- Top Bar
local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.Size = UDim2.new(1, 0, 0, 45)
topBar.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
topBar.BorderSizePixel = 0
topBar.ZIndex = 5 
topBar.Parent = mainFrame
local topCorner = Instance.new("UICorner"); topCorner.CornerRadius = UDim.new(0, 12); topCorner.Parent = topBar
table.insert(transparencyObjects, topBar)

local titleLabel = Instance.new("TextLabel")
titleLabel.Text = "COMMAND CENTER"
titleLabel.Font = Enum.Font.GothamBlack
titleLabel.TextSize = 16
titleLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
titleLabel.Size = UDim2.new(0.6, 0, 1, 0)
titleLabel.Position = UDim2.new(0, 15, 0, 0)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.BackgroundTransparency = 1
titleLabel.ZIndex = 6
titleLabel.Parent = topBar

local closeBtn = Instance.new("TextButton")
closeBtn.Text = "X"; closeBtn.Size = UDim2.new(0, 32, 0, 32); closeBtn.Position = UDim2.new(1, -10, 0.5, 0); closeBtn.AnchorPoint = Vector2.new(1, 0.5); closeBtn.BackgroundColor3 = Color3.fromRGB(180, 60, 60); closeBtn.TextColor3 = Color3.new(1,1,1); closeBtn.Font = Enum.Font.GothamBold; closeBtn.TextSize = 15; closeBtn.ZIndex = 6; closeBtn.Parent = topBar
local closeCorner = Instance.new("UICorner"); closeCorner.CornerRadius = UDim.new(0, 8); closeCorner.Parent = closeBtn
table.insert(transparencyObjects, closeBtn)

-- 3. CONTAINER
local bodyContainer = Instance.new("Frame")
bodyContainer.Size = UDim2.new(1, 0, 1, -45); bodyContainer.Position = UDim2.new(0, 0, 0, 45); bodyContainer.BackgroundTransparency = 1; bodyContainer.ZIndex = 2; bodyContainer.Parent = mainFrame

local sidebarContainer = Instance.new("Frame")
sidebarContainer.Size = UDim2.new(SIDEBAR_WIDTH, 0, 1, 0); sidebarContainer.BackgroundTransparency = 1; sidebarContainer.Parent = bodyContainer
local sidebarLayout = Instance.new("UIListLayout"); sidebarLayout.Padding = UDim.new(0, 6); sidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center; sidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder; sidebarLayout.Parent = sidebarContainer
local sidebarPadding = Instance.new("UIPadding"); sidebarPadding.PaddingTop = UDim.new(0, 15); sidebarPadding.Parent = sidebarContainer

local contentContainer = Instance.new("Frame")
contentContainer.Size = UDim2.new(CONTENT_WIDTH, 0, 1, 0); contentContainer.Position = UDim2.new(SIDEBAR_WIDTH, 0, 0, 0); contentContainer.BackgroundTransparency = 1; contentContainer.Parent = bodyContainer
local pagesFolder = Instance.new("Folder"); pagesFolder.Name = "Pages"; pagesFolder.Parent = contentContainer

-- FUNGSI UI
local function createPage(name, visible)
	local page = Instance.new("ScrollingFrame")
	page.Name = name; page.Size = UDim2.new(1, -15, 1, -15); page.Position = UDim2.new(0, 5, 0, 8); page.BackgroundTransparency = 1; page.ScrollBarThickness = 4; page.Visible = visible; page.Parent = pagesFolder
	local layout = Instance.new("UIListLayout"); layout.Padding = UDim.new(0, 8); layout.HorizontalAlignment = Enum.HorizontalAlignment.Center; layout.SortOrder = Enum.SortOrder.LayoutOrder; layout.Parent = page
	return page
end

local pageLocal = createPage("Local", true)
local pageVisuals = createPage("Visuals", false)
local pageCombat = createPage("Combat", false)
local pageTeleport = createPage("Teleport", false)
local pageSettings = createPage("Settings", false)

local function switchPage(pageName)
	for _, page in pairs(pagesFolder:GetChildren()) do page.Visible = (page.Name == pageName) end
end

local function createSidebarButton(text, targetPageName, urutan)
	local btn = Instance.new("TextButton")
	btn.LayoutOrder = urutan; btn.Size = UDim2.new(0.85, 0, 0, 40); btn.BackgroundColor3 = Color3.fromRGB(50, 50, 55); btn.Text = text; btn.TextColor3 = Color3.fromRGB(180, 180, 180); btn.Font = Enum.Font.GothamMedium; btn.TextSize = 13; btn.Parent = sidebarContainer
	local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0, 8); corner.Parent = btn
	table.insert(transparencyObjects, btn)
	btn.MouseButton1Click:Connect(function() switchPage(targetPageName) end)
end

-- ====================================================
-- FITUR: LOCAL PLAYER (Walkspeed, Noclip, Auto E)
-- ====================================================

-- Toggle Helper
local function createToggle(parent, text, default, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.96, 0, 0, 45); btn.BackgroundColor3 = Color3.fromRGB(45, 45, 50); btn.Text = text .. ": OFF"; btn.TextColor3 = Color3.fromRGB(220, 220, 220); btn.Font = Enum.Font.GothamBold; btn.TextSize = 14; btn.Parent = parent
	local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0, 8); corner.Parent = btn
	table.insert(transparencyObjects, btn)
	local isOn = default
	btn.MouseButton1Click:Connect(function()
		isOn = not isOn
		callback(isOn)
		btn.Text = text .. (isOn and ": ON" or ": OFF")
		TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = isOn and Color3.fromRGB(40, 150, 80) or Color3.fromRGB(45, 45, 50)}):Play()
	end)
	return btn
end

-- Input Box Helper
local function createInputBox(parent, placeholder, callback)
	local box = Instance.new("TextBox")
	box.Size = UDim2.new(0.96, 0, 0, 40); box.BackgroundColor3 = Color3.fromRGB(35, 35, 40); box.Text = ""; box.PlaceholderText = placeholder; box.TextColor3 = Color3.new(1,1,1); box.Font = Enum.Font.GothamMedium; box.TextSize = 14; box.Parent = parent
	local corner = Instance.new("UICorner"); corner.CornerRadius = UDim.new(0, 8); corner.Parent = box
	box.FocusLost:Connect(function(enter) if enter then callback(box.Text) end end)
	return box
end

-- 1. Auto E
createToggle(pageLocal, "Auto Press E (0.1s)", false, function(state)
	autoEEnabled = state
	if state then
		task.spawn(function()
			while autoEEnabled do
				VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
				task.wait(0.05)
				VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
				task.wait(0.1)
			end
		end)
	end
end)

-- 2. Walkspeed (Loop)
createInputBox(pageLocal, "Set Walkspeed (16 - 200)", function(text)
	local num = tonumber(text)
	if num then targetWalkSpeed = num end
end)

createToggle(pageLocal, "Enable Walkspeed Loop", false, function(state)
	walkSpeedEnabled = state
	if state then
		task.spawn(function()
			while walkSpeedEnabled do
				if player.Character and player.Character:FindFirstChild("Humanoid") then
					player.Character.Humanoid.WalkSpeed = targetWalkSpeed
				end
				task.wait() -- Loop cepat tapi hemat, override setiap frame
			end
			-- Reset ke normal saat mati
			if player.Character and player.Character:FindFirstChild("Humanoid") then
				player.Character.Humanoid.WalkSpeed = 16
			end
		end)
	end
end)

-- 3. Perfect Noclip
createToggle(pageLocal, "Perfect Noclip", false, function(state)
	noclipEnabled = state
end)

RunService.Stepped:Connect(function()
	if noclipEnabled and player.Character then
		local char = player.Character
		local hum = char:FindFirstChild("Humanoid")
		
		-- Cek jika sedang memanjat tangga, matikan noclip sebentar agar bisa naik
		local isClimbing = hum and hum:GetState() == Enum.HumanoidStateType.Climbing
		
		if not isClimbing then
			for _, part in pairs(char:GetDescendants()) do
				if part:IsA("BasePart") and part.CanCollide == true then
					part.CanCollide = false
				end
			end
		end
	end
end)

-- ====================================================
-- FITUR: VISUALS (ESP) - Sama seperti sebelumnya
-- ====================================================
createToggle(pageVisuals, "Enemy ESP", false, function(state)
	espEnabled = state
	if not state then 
		for _, v in pairs(game.Workspace:GetDescendants()) do
			if v.Name == "TycoonESP_Highlight" or v.Name == "TycoonESP_Tag" then v:Destroy() end
		end
	end
end)

RunService.RenderStepped:Connect(function()
	if espEnabled then
		for _, target in pairs(Players:GetPlayers()) do
			if target ~= player and target.Character and target.Character:FindFirstChild("Head") and target.Character:FindFirstChild("Humanoid") then
				local isEnemy = true
				if player.Team and target.Team and player.Team == target.Team then isEnemy = false end
				if isEnemy and target.Character.Humanoid.Health > 0 then
					local char = target.Character
					if not char:FindFirstChild("TycoonESP_Highlight") then
						local hl = Instance.new("Highlight"); hl.Name = "TycoonESP_Highlight"; hl.Adornee = char; hl.FillTransparency = 1; hl.OutlineColor = target.TeamColor.Color; hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop; hl.Parent = char
					end
					if not char.Head:FindFirstChild("TycoonESP_Tag") then
						local bg = Instance.new("BillboardGui"); bg.Name = "TycoonESP_Tag"; bg.Adornee = char.Head; bg.Size = UDim2.new(0,200,0,50); bg.StudsOffset = Vector3.new(0,4,0); bg.AlwaysOnTop = true; bg.Parent = char.Head
						local txt = Instance.new("TextLabel"); txt.Name="Info"; txt.Size=UDim2.new(1,0,1,0); txt.BackgroundTransparency=1; txt.TextColor3=Color3.new(1,1,1); txt.TextStrokeTransparency=0; txt.Font=Enum.Font.GothamBold; txt.TextSize=14; txt.Parent=bg
					end
					char.Head.TycoonESP_Tag.Info.Text = target.Name .. " [" .. math.floor(char.Humanoid.Health) .. "]"
				else
					if target.Character:FindFirstChild("TycoonESP_Highlight") then target.Character.TycoonESP_Highlight:Destroy() end
					if target.Character:FindFirstChild("Head") and target.Character.Head:FindFirstChild("TycoonESP_Tag") then target.Character.Head.TycoonESP_Tag:Destroy() end
				end
			end
		end
	end
end)

-- ====================================================
-- FITUR: COMBAT (Bring Enemy)
-- ====================================================

createInputBox(pageCombat, "Exclude Player (Whitelist)", function(name)
	table.insert(bringWhitelist, name)
	print("Added to whitelist:", name)
end)

local function getTarget()
	local targets = {}
	for _, v in pairs(Players:GetPlayers()) do
		if v ~= player and v.Team ~= player.Team then
			-- Cek whitelist
			local isWhitelisted = false
			for _, white in pairs(bringWhitelist) do
				if string.find(v.Name:lower(), white:lower()) then isWhitelisted = true end
			end
			
			if not isWhitelisted and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
				table.insert(targets, v)
			end
		end
	end
	return targets
end

createToggle(pageCombat, "Loop Bring Enemy (Requires Tool/Collision)", false, function(state)
	loopBringEnabled = state
	if state then
		task.spawn(function()
			while loopBringEnabled do
				local targets = getTarget()
				if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
					local myPos = player.Character.HumanoidRootPart.CFrame
					for _, target in pairs(targets) do
						if target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
							-- COBA BAWA MUSUH KE KITA
							-- Metode 1: CFrame Manipulation (Hanya work jika kita punya network ownership atau game unsecure)
							target.Character.HumanoidRootPart.CFrame = myPos * CFrame.new(0, 0, -3)
						end
					end
				end
				task.wait()
			end
		end)
	end
end)

local tpToEnemyBtn = Instance.new("TextButton")
tpToEnemyBtn.Size = UDim2.new(0.96, 0, 0, 45); tpToEnemyBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50); tpToEnemyBtn.Text = "TELEPORT TO NEAREST ENEMY"; tpToEnemyBtn.TextColor3 = Color3.new(1,1,1); tpToEnemyBtn.Font = Enum.Font.GothamBold; tpToEnemyBtn.TextSize = 14; tpToEnemyBtn.Parent = pageCombat
local tpCorner = Instance.new("UICorner"); tpCorner.CornerRadius = UDim.new(0, 8); tpCorner.Parent = tpToEnemyBtn
table.insert(transparencyObjects, tpToEnemyBtn)

tpToEnemyBtn.MouseButton1Click:Connect(function()
	local targets = getTarget()
	if #targets > 0 and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
		local target = targets[math.random(1, #targets)] -- Pilih acak atau bisa diubah ke terdekat
		player.Character.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)
	end
end)


-- ====================================================
-- FITUR: SMART TELEPORT (SafeZone Check)
-- ====================================================

local function IsSafeZoneValid(pos)
	-- Cek apakah ada pijakan di koordinat safezone (Raycast ke bawah)
	local origin = pos + Vector3.new(0, 5, 0)
	local direction = Vector3.new(0, -20, 0)
	local raycastParams = RaycastParams.new()
	raycastParams.FilterDescendantsInstances = {player.Character}
	
	local result = workspace:Raycast(origin, direction, raycastParams)
	if result then
		return true -- Ada part dibawah, aman
	else
		return false -- Void / Tidak ada part
	end
end

local function SmartTeleport(destination)
	if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
	
	-- 1. Cari SafeZone yang valid
	local chosenSafeZone = nil
	for _, szPos in pairs(TeleportData.SafeZones) do
		if IsSafeZoneValid(szPos) then
			chosenSafeZone = szPos
			break -- Ketemu yang valid, stop loop
		end
	end
	
	-- 2. Proses Teleport
	if chosenSafeZone then
		-- TP ke SafeZone dulu
		player.Character.HumanoidRootPart.CFrame = CFrame.new(chosenSafeZone + Vector3.new(0, 3, 0))
		-- Tunggu sebentar (bisa disesuaikan)
		task.wait(0.2)
	end
	
	-- 3. TP ke Tujuan Asli
	player.Character.HumanoidRootPart.CFrame = CFrame.new(destination + Vector3.new(0, 3, 0))
end

local function createTeleportSection(headerText, dataList)
	local lbl = Instance.new("TextLabel"); lbl.Size = UDim2.new(1,0,0,25); lbl.Text = headerText; lbl.BackgroundTransparency=1; lbl.TextColor3=Color3.fromRGB(255,200,50); lbl.Font=Enum.Font.GothamBold; lbl.Parent=pageTeleport
	
	for _, data in pairs(dataList) do
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(0.96, 0, 0, 35); btn.BackgroundColor3 = Color3.fromRGB(40, 40, 45); btn.Text = data.Name; btn.TextColor3 = Color3.fromRGB(200, 200, 200); btn.Font = Enum.Font.GothamMedium; btn.TextSize = 12; btn.Parent = pageTeleport
		local c = Instance.new("UICorner"); c.CornerRadius = UDim.new(0, 6); c.Parent = btn
		table.insert(transparencyObjects, btn)
		
		btn.MouseButton1Click:Connect(function()
			SmartTeleport(data.Pos)
		end)
	end
end

createTeleportSection("--- FLAGS ---", TeleportData.Flags)
createTeleportSection("--- SPAWNS ---", TeleportData.Spawns)
createTeleportSection("--- TEAMS ---", TeleportData.Teams)
createTeleportSection("--- SAFEZONES (Direct) ---", {{Name="Red SZ", Pos=TeleportData.SafeZones[1]}, {Name="Green SZ", Pos=TeleportData.SafeZones[2]}})


-- ====================================================
-- SETTINGS & TOGGLE MENU
-- ====================================================
createSidebarButton("Local", "Local", 1)
createSidebarButton("Visuals", "Visuals", 2)
createSidebarButton("Combat", "Combat", 3)
createSidebarButton("Teleport", "Teleport", 4)
createSidebarButton("Settings", "Settings", 99)

-- (Settings Close/Unload sama seperti sebelumnya, dipersingkat)
local unloadBtn = Instance.new("TextButton"); unloadBtn.Size = UDim2.new(0.96, 0, 0, 40); unloadBtn.BackgroundColor3 = Color3.fromRGB(150, 40, 40); unloadBtn.Text = "UNLOAD"; unloadBtn.TextColor3 = Color3.new(1,1,1); unloadBtn.Parent = pageSettings; local uc = Instance.new("UICorner"); uc.CornerRadius = UDim.new(0,8); uc.Parent = unloadBtn
unloadBtn.MouseButton1Click:Connect(function() screenGui:Destroy(); script:Destroy() end)

-- Toggle Menu Logic
local toggleBtn = Instance.new("TextButton")
toggleBtn.Name = "ToggleDashboard"
toggleBtn.Size = UDim2.new(0, 130, 0, 40)
toggleBtn.Position = UDim2.new(0, 20, 0.9, -20)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
toggleBtn.Text = "MENU"
toggleBtn.Font = Enum.Font.GothamBlack
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.TextSize = 14
toggleBtn.Parent = screenGui
local toggleCorner = Instance.new("UICorner"); toggleCorner.CornerRadius = UDim.new(1, 0); toggleCorner.Parent = toggleBtn

local toggled = false
local function toggleGui()
	toggled = not toggled
	mainFrame.Visible = toggled
	if toggled then
		mainFrame.Position = UDim2.new(0.5, 0, 0.55, 0)
		TweenService:Create(mainFrame, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Position = UDim2.new(0.5, 0, 0.5, 0)}):Play()
	end
end
toggleBtn.MouseButton1Click:Connect(toggleGui)
closeBtn.MouseButton1Click:Connect(toggleGui)
UserInputService.InputBegan:Connect(function(input) if input.KeyCode == currentHotkey then toggleGui() end end)
