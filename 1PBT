local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Camera = workspace.CurrentCamera
local TeleportService = game:GetService("TeleportService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local mouse = player:GetMouse()

local currentHotkey = Enum.KeyCode.LeftAlt
local savedTransparency = 0
local SIDEBAR_WIDTH = 0.15
local CONTENT_WIDTH = 1 - SIDEBAR_WIDTH

local TeleportData = {
	SafeZones = {
		["Red"] = Vector3.new(-428, 42, 9),
		["Green"] = Vector3.new(-428, 42, -190),
		["Blue"] = Vector3.new(-314, 41, -480),
		["Yellow"] = Vector3.new(-115, 41, -481)
	},
	Flags = {
		{Name = "Hill Flag", Pos = Vector3.new(-27, 101, -79)}
	},
	Locations = {
		{Name = "Red Spawn", Pos = Vector3.new(-364, 65, -63)},
		{Name = "Red Skyland", Pos = Vector3.new(-418, 494, -47)},
		{Name = "Green Spawn", Pos = Vector3.new(-364, 65, -263)},
		{Name = "Green 3rdFloor", Pos = Vector3.new(-354, 101, -313)},
		{Name = "Green Skyland", Pos = Vector3.new(-422, 494, -248)},
		{Name = "Blue Spawn", Pos = Vector3.new(-241, 65, -417)},
		{Name = "Yellow Spawn", Pos = Vector3.new(-41, 65, -417)},
		{Name = "Orange Spawn", Pos = Vector3.new(159, 65, -417)},
		{Name = "Purple Spawn", Pos = Vector3.new(312, 65, -294)},
		{Name = "White Spawn", Pos = Vector3.new(312, 65, -94)},
		{Name = "Black Spawn", Pos = Vector3.new(313, 65, 106)},
		{Name = "Brown Spawn", Pos = Vector3.new(190, 65, 259)},
		{Name = "Cyan Spawn", Pos = Vector3.new(-10, 65, 259)},
		{Name = "Grey Spawn", Pos = Vector3.new(-210, 65, 259)},
		{Name = "Pink Spawn", Pos = Vector3.new(-364, 65, 137)}
	}
}

local TeamColors = {"Red","Green","Blue","Yellow","Orange","Purple","White","Black","Brown","Cyan","Grey","Pink"}
local currentTeamIndex = 1

local sliderFunction = nil
local transparencyObjects = {}

local espEnabled = false
local noclipEnabled = false
local autoEEnabled = false
local walkSpeedEnabled = false
local targetWalkSpeed = 25

local loopBringEnabled = false
local bringWhitelist = {}
local bringMode = "ALL"
local singleTargetName = ""

local Toggles = {} 

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "Ploit"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = playerGui

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0.5,0,0.6,0)
mainFrame.Position = UDim2.new(0.5,0,0.5,0)
mainFrame.AnchorPoint = Vector2.new(0.5,0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner", mainFrame)
mainCorner.CornerRadius = UDim.new(0,12)
table.insert(transparencyObjects, mainFrame)
Instance.new("UIDragDetector", mainFrame)

local sizeConstraint = Instance.new("UISizeConstraint")
sizeConstraint.MinSize = Vector2.new(350,250)
sizeConstraint.MaxSize = Vector2.new(900,600)
sizeConstraint.Parent = mainFrame

local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.Size = UDim2.new(1,0,0,35)
topBar.BackgroundColor3 = Color3.fromRGB(30,30,30)
topBar.BorderSizePixel = 0
topBar.Parent = mainFrame
table.insert(transparencyObjects, topBar)
local topCorner = Instance.new("UICorner", topBar)
topCorner.CornerRadius = UDim.new(0,12)

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1,-100,1,0)
titleLabel.Position = UDim2.new(0,10,0,0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "BATTLE TYCOON"
titleLabel.TextColor3 = Color3.fromRGB(255,255,255)
titleLabel.Font = Enum.Font.GothamBlack
titleLabel.TextSize = 14
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = topBar

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0,30,0,30)
closeBtn.Position = UDim2.new(1,-35,0,2)
closeBtn.Text = "-"
closeBtn.BackgroundColor3 = Color3.fromRGB(120,50,50)
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14
closeBtn.Parent = topBar
table.insert(transparencyObjects, closeBtn)
local closeCorner = Instance.new("UICorner", closeBtn)
closeCorner.CornerRadius = UDim.new(0,6)

closeBtn.MouseButton1Click:Connect(function() mainFrame.Visible = false end)

local sidebar = Instance.new("ScrollingFrame")
sidebar.Name = "Sidebar"
sidebar.Size = UDim2.new(SIDEBAR_WIDTH,0,1,-35)
sidebar.Position = UDim2.new(0,0,0,35)
sidebar.BackgroundColor3 = Color3.fromRGB(35,35,40)
sidebar.BorderSizePixel = 0
sidebar.ScrollBarThickness = 2
sidebar.Parent = mainFrame
table.insert(transparencyObjects, sidebar)
local sideCorner = Instance.new("UICorner", sidebar)
sideCorner.CornerRadius = UDim.new(0,12)

local sidebarLayout = Instance.new("UIListLayout")
sidebarLayout.Padding = UDim.new(0,8)
sidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
sidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
sidebarLayout.Parent = sidebar

local sidebarPadding = Instance.new("UIPadding")
sidebarPadding.PaddingTop = UDim.new(0,10)
sidebarPadding.Parent = sidebar

local contentFrame = Instance.new("ScrollingFrame")
contentFrame.Name = "Content"
contentFrame.Size = UDim2.new(CONTENT_WIDTH,0,1,-35)
contentFrame.Position = UDim2.new(SIDEBAR_WIDTH,0,0,35)
contentFrame.BackgroundColor3 = Color3.fromRGB(20,20,25)
contentFrame.BorderSizePixel = 0
contentFrame.ScrollBarThickness = 5
contentFrame.Parent = mainFrame
table.insert(transparencyObjects, contentFrame)
local contentCorner = Instance.new("UICorner", contentFrame)
contentCorner.CornerRadius = UDim.new(0,12)

local pagesFolder = Instance.new("Folder")
pagesFolder.Name = "Pages"
pagesFolder.Parent = contentFrame

local function createPage(name, visible)
	local page = Instance.new("ScrollingFrame")
	page.Name = name
	page.Size = UDim2.new(1,-10,1,-10)
	page.Position = UDim2.new(0,5,0,5)
	page.BackgroundTransparency = 1
	page.ScrollBarThickness = 6
	page.ScrollBarImageColor3 = Color3.fromRGB(80,80,90)
	page.Visible = visible
	page.AutomaticCanvasSize = Enum.AutomaticSize.Y
	page.CanvasSize = UDim2.new()
	page.Parent = pagesFolder

	local layout = Instance.new("UIListLayout")
	layout.Padding = UDim.new(0,8)
	layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	layout.SortOrder = Enum.SortOrder.LayoutOrder
	layout.Parent = page

	local pad = Instance.new("UIPadding")
	pad.PaddingBottom = UDim.new(0,20)
	pad.PaddingTop = UDim.new(0,5)
	pad.Parent = page

	return page
end

local pageLocal    = createPage("Local", true)
local pageVisuals  = createPage("Visuals", false)
local pageCombat   = createPage("Combat", false)
local pageTeleport = createPage("Teleport", false)
local pageSettings = createPage("Settings", false)

local function switchPage(pageName)
	for _, page in pairs(pagesFolder:GetChildren()) do
		if page:IsA("ScrollingFrame") then
			page.Visible = (page.Name == pageName)
		end
	end
end

local function createSidebarButton(text, targetPage, order)
	local btn = Instance.new("TextButton")
	btn.LayoutOrder = order
	btn.Size = UDim2.new(0.85,0,0,40)
	btn.BackgroundColor3 = Color3.fromRGB(50,50,55)
	btn.Text = text
	btn.TextColor3 = Color3.fromRGB(180,180,180)
	btn.Font = Enum.Font.GothamMedium
	btn.TextSize = 13
	btn.Parent = sidebar
	local corner = Instance.new("UICorner", btn)
	corner.CornerRadius = UDim.new(0,8)
	table.insert(transparencyObjects, btn)
	btn.MouseButton1Click:Connect(function() switchPage(targetPage) end)
end

createSidebarButton("Player",    "Local",    1)
createSidebarButton("Visual",    "Visuals",  2)
createSidebarButton("Battle",    "Combat",   3)
createSidebarButton("Teleport",  "Teleport", 4)
createSidebarButton("Settings",  "Settings", 9)

local function createToggle(parent, text, default, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.96,0,0,45)
	btn.BackgroundColor3 = Color3.fromRGB(45,45,50)
	btn.Text = text .. ": OFF"
	btn.TextColor3 = Color3.fromRGB(220,220,220)
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 14
	btn.Parent = parent

	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)
	table.insert(transparencyObjects, btn)

	local isOn = default

	local function updateState(newState)
		isOn = newState
		if callback then callback(isOn) end

		btn.Text = text .. (isOn and ": ON" or ": OFF")

		TweenService:Create(
			btn,
			TweenInfo.new(0.2),
			{
				BackgroundColor3 = isOn and Color3.fromRGB(40,150,80) or Color3.fromRGB(45,45,50)
			}
		):Play()
	end

	btn.MouseButton1Click:Connect(function()
		updateState(not isOn)
	end)

	return btn, updateState
end

local function createInputBox(parent, placeholder, callback)
	local box = Instance.new("TextBox")
	box.Size = UDim2.new(0.96,0,0,40)
	box.BackgroundColor3 = Color3.fromRGB(35,35,40)
	box.PlaceholderText = placeholder
	box.Text = ""
	box.TextColor3 = Color3.new(1,1,1)
	box.Font = Enum.Font.GothamMedium
	box.TextSize = 14
	box.Parent = parent
	Instance.new("UICorner", box).CornerRadius = UDim.new(0,8)
	box.FocusLost:Connect(function(enter)
		if enter then callback(box.Text) end
	end)
	return box
end

local function DropAllTools()
	if not player.Character then return end
	for i,v in pairs(player.Backpack:GetChildren()) do
		if v:IsA("Tool") then v.Parent = player.Character end
	end
	task.wait()
	for i,v in pairs(player.Character:GetChildren()) do
		if v:IsA("Tool") then v.Parent = workspace end
	end
end

local function GetTargetPlayer(partialName)
	for _, p in pairs(Players:GetPlayers()) do
		if p ~= player and string.find(p.Name:lower(), partialName:lower()) then
			return p
		end
	end
	return nil
end

local dropBtn = Instance.new("TextButton")
dropBtn.Size = UDim2.new(0.96,0,0,45)
dropBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
dropBtn.Text = "DROPTOOLS (G)"
dropBtn.TextColor3 = Color3.new(1,1,1)
dropBtn.Font = Enum.Font.GothamBlack
dropBtn.TextSize = 14
dropBtn.Parent = pageLocal
Instance.new("UICorner", dropBtn).CornerRadius = UDim.new(0,8)
table.insert(transparencyObjects, dropBtn)

dropBtn.MouseButton1Click:Connect(DropAllTools)

local btnAutoE, toggleAutoE = createToggle(pageLocal, "AutoPressE (F2)", false, function(state)
	autoEEnabled = state
	if state then
		task.spawn(function()
			while autoEEnabled do
				VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
				task.wait(0.05)
				VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
				task.wait(0.1)
			end
		end)
	end
end)
Toggles.AutoE = {Enabled = false, Func = toggleAutoE}

createInputBox(pageLocal, "Set Walkspeed (16 - 200)", function(text)
	local num = tonumber(text)
	if num then targetWalkSpeed = num end
end)

local btnSpeed, toggleSpeed = createToggle(pageLocal, "Walkspeed(F3)", false, function(state)
	walkSpeedEnabled = state
	if state then
		task.spawn(function()
			while walkSpeedEnabled do
				if player.Character and player.Character:FindFirstChild("Humanoid") then
					player.Character.Humanoid.WalkSpeed = targetWalkSpeed
				end
				task.wait()
			end
			if player.Character and player.Character:FindFirstChild("Humanoid") then
				player.Character.Humanoid.WalkSpeed = 16
			end
		end)
	end
end)
Toggles.Walkspeed = {Enabled = false, Func = toggleSpeed}

local btnNoclip, toggleNoclip = createToggle(pageLocal, "Noclip (N)", false, function(state)
	noclipEnabled = state
end)
Toggles.Noclip = {Enabled = false, Func = toggleNoclip}

RunService.Stepped:Connect(function()
	if not noclipEnabled or not player.Character then return end
	local hum = player.Character:FindFirstChild("Humanoid")
	if hum and hum:GetState() == Enum.HumanoidStateType.Climbing then return end
	for _, part in pairs(player.Character:GetDescendants()) do
		if part:IsA("BasePart") and part.CanCollide then part.CanCollide = false end
	end
end)

local EspCache = {}
local EspConnection = nil
local espEnabled = false

local SETTINGS = {
	TeamCheck = true,
	EnemyColor = Color3.fromRGB(255, 0, 0),
	TeamColor = Color3.fromRGB(0, 255, 0),
	MaxDistance = 1000,
	TextSize = 14
}

local function GetESPColor(p)
	if SETTINGS.TeamCheck and p.Team and player.Team and p.Team == player.Team then
		return SETTINGS.TeamColor
	else
		return SETTINGS.EnemyColor
	end
end

local function RemoveESP(p)
	if EspCache[p] then
		pcall(function()
			if EspCache[p].Highlight then EspCache[p].Highlight:Destroy() end
			if EspCache[p].Billboard then EspCache[p].Billboard:Destroy() end
			if EspCache[p].Connections then
				for _, conn in pairs(EspCache[p].Connections) do conn:Disconnect() end
			end
		end)
		EspCache[p] = nil
	end
end

local function CreateESP(p)
	if p == player then return end
	RemoveESP(p)

	local data = {
		player = p,
		Connections = {}
	}
	EspCache[p] = data

	local function CharacterAdded(char)
		local hrp = char:WaitForChild("HumanoidRootPart", 10)
		local hum = char:WaitForChild("Humanoid", 10)
		if not hrp or not hum then return end

		local hl = Instance.new("Highlight")
		hl.FillTransparency = 1
		hl.OutlineTransparency = 0
		hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
		hl.Enabled = espEnabled
		hl.Parent = char
		hl.Adornee = char

		local bg = Instance.new("BillboardGui")
		bg.Name = "EspInfo"
		bg.Size = UDim2.new(0, 200, 0, 50)
		bg.StudsOffset = Vector3.new(0, 3.5, 0)
		bg.AlwaysOnTop = true
		bg.Enabled = espEnabled
		bg.Parent = char
		bg.Adornee = char:WaitForChild("Head", 5) or hrp

		local txt = Instance.new("TextLabel")
		txt.Size = UDim2.new(1, 0, 1, 0)
		txt.BackgroundTransparency = 1
		txt.Font = Enum.Font.GothamBold
		txt.TextSize = SETTINGS.TextSize
		txt.TextColor3 = Color3.new(1, 1, 1)
		txt.TextStrokeTransparency = 0
		txt.TextStrokeColor3 = Color3.new(0, 0, 0)
		txt.Parent = bg

		data.Highlight = hl
		data.Billboard = bg
		data.Text = txt
		data.Character = char
		data.Hrp = hrp
		data.Humanoid = hum

		local color = GetESPColor(p)
		hl.FillColor = color
		hl.OutlineColor = color
		txt.TextColor3 = color

		table.insert(data.Connections, p:GetPropertyChangedSignal("Team"):Connect(function()
			local newColor = GetESPColor(p)
			if hl.Parent then
				hl.FillColor = newColor
				hl.OutlineColor = newColor
				txt.TextColor3 = newColor
			end
		end))
	end

	if p.Character then 
		task.spawn(function() CharacterAdded(p.Character) end)
	end
	table.insert(data.Connections, p.CharacterAdded:Connect(CharacterAdded))
end

local function UpdateLoop()
	local myChar = player.Character
	local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")
	local myPos = myRoot and myRoot.Position or Vector3.zero

	for p, data in pairs(EspCache) do
		if data.Character and data.Hrp and data.Humanoid and data.Humanoid.Health > 0 then
			local dist = (myPos - data.Hrp.Position).Magnitude

			if dist <= SETTINGS.MaxDistance then
				if not data.Highlight.Enabled then
					data.Highlight.Enabled = true
					data.Billboard.Enabled = true
				end

				data.Text.Text = string.format("%s\n[HP: %d] [%d m]", 
					p.DisplayName, 
					math.floor(data.Humanoid.Health), 
					math.floor(dist)
				)
			else
				data.Highlight.Enabled = false
				data.Billboard.Enabled = false
			end
		else
			if data.Highlight then data.Highlight.Enabled = false end
			if data.Billboard then data.Billboard.Enabled = false end
		end
	end
end

local btnESP, toggleESP = createToggle(pageVisuals, "ESP (F1)", false, function(state)
	espEnabled = state

	if state then
		if EspConnection then EspConnection:Disconnect() end
		EspConnection = RunService.RenderStepped:Connect(UpdateLoop)
		
		for _, data in pairs(EspCache) do
			if data.Highlight then data.Highlight.Enabled = true end
			if data.Billboard then data.Billboard.Enabled = true end
		end
	else
		if EspConnection then EspConnection:Disconnect() end
		
		for _, data in pairs(EspCache) do
			if data.Highlight then data.Highlight.Enabled = false end
			if data.Billboard then data.Billboard.Enabled = false end
		end
	end
end)

Toggles.ESP = {Enabled = false, Func = toggleESP}

for _, v in ipairs(Players:GetPlayers()) do 
	if v ~= player then CreateESP(v) end 
end
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)
createInputBox(pageCombat, "Whitelist Player (Name)", function(name)
	table.insert(bringWhitelist, name)
end)

for _, p in ipairs(Players:GetPlayers()) do CreateESP(p) end
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)
createInputBox(pageCombat, "Whitelist Player (Name)", function(name)
	table.insert(bringWhitelist, name)
end)

local modeBtn = Instance.new("TextButton")
modeBtn.Size = UDim2.new(0.96,0,0,40)
modeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
modeBtn.Text = "Mode: ALL"
modeBtn.TextColor3 = Color3.fromRGB(255,200,100)
modeBtn.Font = Enum.Font.GothamBold
modeBtn.TextSize = 14
modeBtn.Parent = pageCombat
Instance.new("UICorner", modeBtn).CornerRadius = UDim.new(0,8)
table.insert(transparencyObjects, modeBtn)

modeBtn.MouseButton1Click:Connect(function()
	if bringMode == "ALL" then
		bringMode = "SINGLE"
		modeBtn.Text = "Mode: SINGLE TARGET"
		modeBtn.TextColor3 = Color3.fromRGB(100,255,100)
	else
		bringMode = "ALL"
		modeBtn.Text = "Mode: ALL"
		modeBtn.TextColor3 = Color3.fromRGB(255,200,100)
	end
end)

createInputBox(pageCombat, "Target Name (For Single Mode)", function(text)
	singleTargetName = text
end)

local btnBring, toggleBring = createToggle(pageCombat, "Bring Enemy (B)", false, function(state)
	loopBringEnabled = state

	if state then
		task.spawn(function()
			while loopBringEnabled do
				local myChar = player.Character
				if myChar and myChar:FindFirstChild("HumanoidRootPart") then
					local myRoot = myChar.HumanoidRootPart.CFrame

					if bringMode == "ALL" then
						for _, v in pairs(Players:GetPlayers()) do
							if v ~= player and v.Team ~= player.Team and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
								local isWhite = false
								for _, w in pairs(bringWhitelist) do
									if string.find(v.Name:lower(), w:lower()) then isWhite = true end
								end

								if not isWhite then
									v.Character.HumanoidRootPart.CFrame = myRoot * CFrame.new(0,0,-3)
								end
							end
						end

					elseif bringMode == "SINGLE" then
						local target = GetTargetPlayer(singleTargetName)
						if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
							target.Character.HumanoidRootPart.CFrame = myRoot * CFrame.new(0,0,-3)
						end
					end
				end
				task.wait(0.1)
			end
		end)
	end
end)
Toggles.Bring = {Enabled = false, Func = toggleBring}

local function GetMySafezone()
	local teamName = player.Team and player.Team.Name
	if teamName and TeleportData.SafeZones[teamName] then
		return TeleportData.SafeZones[teamName]
	end
	return nil
end

local function IsInSafezone(safezonePos)
	if not safezonePos then return false end
	local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
	if root then
		return (root.Position - safezonePos).Magnitude <= 30
	end
	return false
end

local function SmartTeleport(destination)
	local char = player.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	local hum = char and char:FindFirstChild("Humanoid")

	if not root or not hum or hum.Health <= 0 then return end

	-- 1. Reset Fisika Total (Kunci agar mulus)
	root.AssemblyLinearVelocity = Vector3.zero
	root.AssemblyAngularVelocity = Vector3.zero

	local mySafezone = GetMySafezone()

	-- 2. Transit Kilat
	-- Jika punya Safezone DAN kita sedang di luar (medan perang)
	if mySafezone and not IsInSafezone(mySafezone) then
		
		-- Pindahkan posisi ke Safezone
		root.CFrame = CFrame.new(mySafezone + Vector3.new(0, 3, 0))
		
		-- [KUNCI KECEPATAN]:
		-- Jangan pakai loop "repeat wait". 
		-- Cukup tunggu 1 detak jantung fisika (Heartbeat) agar server meregistrasi posisi safezone.
		-- Ini terjadi dalam sepersekian detik (tidak kasat mata).
		RunService.Heartbeat:Wait() 
		
		-- Reset velocity lagi jaga-jaga ada momentum sisa
		root.AssemblyLinearVelocity = Vector3.zero
	end

	-- 3. Langsung Teleport ke Tujuan
	if hum.Health > 0 then
		root.CFrame = CFrame.new(destination + Vector3.new(0, 3.5, 0))
	end
end

local flagLabel = Instance.new("TextLabel")
flagLabel.Size = UDim2.new(1,0,0,25) 
flagLabel.Text = "Neutral Area" 
flagLabel.BackgroundTransparency=1 
flagLabel.TextColor3=Color3.fromRGB(255,200,50) 
flagLabel.Font=Enum.Font.GothamBold 
flagLabel.Parent=pageTeleport

for _, data in pairs(TeleportData.Flags) do
	local btn = Instance.new("TextButton") 
	btn.Size = UDim2.new(0.96,0,0,40) 
	btn.BackgroundColor3 = Color3.fromRGB(45,45,50) 
	btn.Text = data.Name 
	btn.TextColor3 = Color3.new(1,1,1) 
	btn.Font = Enum.Font.GothamBlack 
	btn.Parent = pageTeleport 
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6) 
	table.insert(transparencyObjects, btn)
	
	btn.MouseButton1Click:Connect(function() SmartTeleport(data.Pos) end)
end

local selectorLabel = Instance.new("TextLabel") 
selectorLabel.Size = UDim2.new(1,0,0,25) 
selectorLabel.Text = "SELECT TEAM AREA" 
selectorLabel.BackgroundTransparency=1 
selectorLabel.TextColor3=Color3.fromRGB(255,255,255) 
selectorLabel.Font=Enum.Font.GothamBold 
selectorLabel.Parent=pageTeleport

local navContainer = Instance.new("Frame") 
navContainer.Size = UDim2.new(0.96,0,0,45) 
navContainer.BackgroundColor3 = Color3.fromRGB(40,40,45) 
navContainer.Parent = pageTeleport 
Instance.new("UICorner", navContainer).CornerRadius = UDim.new(0,8) 
table.insert(transparencyObjects, navContainer)

local prevBtn = Instance.new("TextButton") 
prevBtn.Size = UDim2.new(0,45,1,0) 
prevBtn.Text = "<" 
prevBtn.Font = Enum.Font.GothamBold 
prevBtn.TextColor3 = Color3.fromRGB(200,200,200) 
prevBtn.BackgroundColor3 = Color3.fromRGB(50,50,60) 
prevBtn.Parent = navContainer 
Instance.new("UICorner", prevBtn).CornerRadius = UDim.new(0,8)

local nextBtn = Instance.new("TextButton") 
nextBtn.Size = UDim2.new(0,45,1,0) 
nextBtn.Position = UDim2.new(1,-45,0,0) 
nextBtn.Text = ">" 
nextBtn.Font = Enum.Font.GothamBold 
nextBtn.TextColor3 = Color3.fromRGB(200,200,200) 
nextBtn.BackgroundColor3 = Color3.fromRGB(50,50,60) 
nextBtn.Parent = navContainer 
Instance.new("UICorner", nextBtn).CornerRadius = UDim.new(0,8)

local currentTeamLabel = Instance.new("TextLabel") 
currentTeamLabel.Size = UDim2.new(1,-90,1,0) 
currentTeamLabel.Position = UDim2.new(0,45,0,0) 
currentTeamLabel.BackgroundTransparency = 1 
currentTeamLabel.Text = "TEAM: RED" 
currentTeamLabel.Font = Enum.Font.GothamBlack 
currentTeamLabel.TextColor3 = Color3.new(1,1,1) 
currentTeamLabel.Parent = navContainer

local dynamicContainer = Instance.new("Frame") 
dynamicContainer.Size = UDim2.new(1,0,0,0)
dynamicContainer.AutomaticSize = Enum.AutomaticSize.Y 
dynamicContainer.BackgroundTransparency = 1 
dynamicContainer.Parent = pageTeleport 

local dynamicLayout = Instance.new("UIListLayout", dynamicContainer) 
dynamicLayout.Padding = UDim.new(0,8) 
dynamicLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function UpdateTeamDisplay()
	local teamName = TeamColors[currentTeamIndex]
	currentTeamLabel.Text = "TEAM: " .. string.upper(teamName)
	
	for _, v in pairs(dynamicContainer:GetChildren()) do 
		if v:IsA("TextButton") then v:Destroy() end 
	end
	
	for _, data in pairs(TeleportData.Locations) do
		if string.find(data.Name, teamName) then
			local btn = Instance.new("TextButton") 
			btn.Size = UDim2.new(0.96,0,0,35) 
			btn.BackgroundColor3 = Color3.fromRGB(40,40,45) 
			btn.Text = data.Name 
			btn.TextColor3 = Color3.fromRGB(200,200,200) 
			btn.Font = Enum.Font.GothamMedium 
			btn.Parent = dynamicContainer 

			local c = Instance.new("UICorner", btn) 
			c.CornerRadius = UDim.new(0,6) 
			table.insert(transparencyObjects, btn)
			btn.MouseButton1Click:Connect(function() SmartTeleport(data.Pos) end)
		end
	end
end
prevBtn.MouseButton1Click:Connect(function() 
	currentTeamIndex -= 1 
	if currentTeamIndex < 1 then 
		currentTeamIndex = #TeamColors end 
	UpdateTeamDisplay() 
end)

nextBtn.MouseButton1Click:Connect(function() 
	currentTeamIndex += 1 
	if currentTeamIndex > #TeamColors then 
		currentTeamIndex = 1 end
	UpdateTeamDisplay() 
end)
UpdateTeamDisplay()


local function createSettingLabel(text) 
	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.new(0.94, 0, 0, 30)
	lbl.BackgroundTransparency = 1
	lbl.Text = text
	lbl.TextColor3 = Color3.fromRGB(150, 150, 150)
	lbl.Font = Enum.Font.GothamBold
	lbl.TextSize = 12
	lbl.TextXAlignment = Enum.TextXAlignment.Left
	lbl.Parent = pageSettings 
end

createSettingLabel("TRANSPARENCY") 

local sliderContainer = Instance.new("Frame")
sliderContainer.Size = UDim2.new(0.94,0,0,30)
sliderContainer.BackgroundTransparency = 1
sliderContainer.Parent = pageSettings

local sliderBar = Instance.new("Frame")
sliderBar.Size = UDim2.new(0.95,0,0,6)
sliderBar.AnchorPoint = Vector2.new(0.5,0.5)
sliderBar.Position = UDim2.new(0.5,0,0.5,0)
sliderBar.BackgroundColor3 = Color3.fromRGB(60,60,70)
sliderBar.Parent = sliderContainer
Instance.new("UICorner", sliderBar).CornerRadius = UDim.new(1,0)

local sliderKnob = Instance.new("TextButton")
sliderKnob.Size = UDim2.new(0,25,0,25)
sliderKnob.AnchorPoint = Vector2.new(0.5,0.5)
sliderKnob.Position = UDim2.new(0,0,0.5,0)
sliderKnob.BackgroundColor3 = Color3.fromRGB(0,120,215)
sliderKnob.TextTransparency = 1
sliderKnob.Parent = sliderBar
Instance.new("UICorner", sliderKnob).CornerRadius = UDim.new(1,0)

local sliderValueLabel = Instance.new("TextLabel")
sliderValueLabel.Size = UDim2.new(0,50,1,0)
sliderValueLabel.Position = UDim2.new(-0.5,0,-1,0)
sliderValueLabel.BackgroundTransparency = 1
sliderValueLabel.Text = "0%"
sliderValueLabel.TextColor3 = Color3.fromRGB(200,200,200)
sliderValueLabel.Parent = sliderKnob

local function applyTransparency(val) 
	savedTransparency = val
	for _, obj in pairs(transparencyObjects) do 
		TweenService:Create(obj, TweenInfo.new(0.1), {BackgroundTransparency = val}):Play() 
	end 
end

local dragging = false
local function updateSlider(inputPos) 
	local barPos = sliderBar.AbsolutePosition
	local barSize = sliderBar.AbsoluteSize
	local relativeX = math.clamp((inputPos.X - barPos.X) / barSize.X, 0, 1)
	sliderKnob.Position = UDim2.new(relativeX,0,0.5,0)
	sliderValueLabel.Text = math.floor(relativeX * 100) .. "%"
	applyTransparency(relativeX) 
end

sliderKnob.InputBegan:Connect(function(input) 
	if input.UserInputType == Enum.UserInputType.MouseButton1 
		or input.UserInputType == Enum.UserInputType.Touch then 
		dragging = true 
	end 
end)
UserInputService.InputEnded:Connect(function(input) 
	if input.UserInputType == Enum.UserInputType.MouseButton1 
		or input.UserInputType == Enum.UserInputType.Touch 
	then dragging = false end 
end)
UserInputService.InputChanged:Connect(function(input) 
	if dragging 
		and (input.UserInputType == Enum.UserInputType.MouseMovement 
			or input.UserInputType == Enum.UserInputType.Touch) then 
		updateSlider(input.Position) 	
	end 
end)

createSettingLabel(" ")

local unloadBtn = Instance.new("TextButton")
unloadBtn.Size = UDim2.new(0.96,0,0,45)
unloadBtn.BackgroundColor3 = Color3.fromRGB(180,50,50)
unloadBtn.Text = "UNLOAD"
unloadBtn.TextColor3 = Color3.new(1,1,1)
unloadBtn.Font = Enum.Font.GothamBlack
unloadBtn.Parent = pageSettings
Instance.new("UICorner", unloadBtn).CornerRadius = UDim.new(0,8)
table.insert(transparencyObjects, unloadBtn)

unloadBtn.MouseButton1Click:Connect(function() 
	screenGui:Destroy()
	script:Destroy() 
end)

local toggleBtn = Instance.new("TextButton") 
toggleBtn.Size = UDim2.new(0,130,0,40) 
toggleBtn.Position = UDim2.new(0,20,0.9,-20) 
toggleBtn.BackgroundColor3 = Color3.fromRGB(0,120,215) 
toggleBtn.Text = "MENU" 
toggleBtn.Font = Enum.Font.GothamBlack 
toggleBtn.TextColor3 = Color3.new(1,1,1) 
toggleBtn.Parent = screenGui 
local cornerbtn = Instance.new("UICorner")
cornerbtn.Parent = toggleBtn
cornerbtn.CornerRadius = UDim.new(0,8)

local toggled = false 
local function toggleGui() 
	toggled = not toggled 
	mainFrame.Visible = toggled 
	if toggled then 
		mainFrame.Position = UDim2.new(0.5,0,0.55,0) 
		TweenService:Create(mainFrame, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), 
			{Position = UDim2.new(0.5,0,0.5,0)}):Play() 
		applyTransparency(savedTransparency)
	end 
end
toggleBtn.MouseButton1Click:Connect(toggleGui) 
closeBtn.MouseButton1Click:Connect(toggleGui)

UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end

	if input.KeyCode == currentHotkey then
		toggleGui()
	elseif input.KeyCode == Enum.KeyCode.F1 then
		Toggles.ESP.Enabled = not Toggles.ESP.Enabled
		Toggles.ESP.Func(Toggles.ESP.Enabled)
	elseif input.KeyCode == Enum.KeyCode.F2 then
		Toggles.AutoE.Enabled = not Toggles.AutoE.Enabled
		Toggles.AutoE.Func(Toggles.AutoE.Enabled)
	elseif input.KeyCode == Enum.KeyCode.N then
		Toggles.Noclip.Enabled = not Toggles.Noclip.Enabled
		Toggles.Noclip.Func(Toggles.Noclip.Enabled)
	elseif input.KeyCode == Enum.KeyCode.F3 then
		Toggles.Walkspeed.Enabled = not Toggles.Walkspeed.Enabled
		Toggles.Walkspeed.Func(Toggles.Walkspeed.Enabled)
	elseif input.KeyCode == Enum.KeyCode.G then
		DropAllTools()
	elseif input.KeyCode == Enum.KeyCode.B then
		Toggles.Bring.Enabled = not Toggles.Bring.Enabled
		Toggles.Bring.Func(Toggles.Bring.Enabled)
	end
end)
